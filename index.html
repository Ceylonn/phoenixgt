<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>åƒæ°´æœé—®é¢˜å¯è§†åŒ–</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .plate-area {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    .plate {
      width: 120px;
      height: 120px;
      border: 4px dashed #7f8c8d;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
    }
    .log-container {
      height: 200px;
      overflow-y: auto;
      background: #f1f1f1;
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
      font-family: monospace;
      font-size: 14px;
    }
    .status-bar {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
      flex-wrap: wrap;
      gap: 10px;
    }
    .person {
      text-align: center;
      padding: 10px;
      border-radius: 8px;
      min-width: 100px;
    }
    .person.father { background-color: #e3f2fd; border-left: 4px solid #2196f3; }
    .person.mother { background-color: #ffebee; border-left: 4px solid #f44336; }
    .person.son     { background-color: #e8f5e9; border-left: 4px solid #4caf50; }
    .person.daughter{ background-color: #f3e5f5; border-left: 4px solid #9c27b0; }
    .status {
      font-weight: bold;
      margin-top: 4px;
      font-size: 14px;
    }
    .controls {
      text-align: center;
      margin-top: 20px;
    }
    button {
      margin: 0 8px;
      padding: 8px 16px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .run { background: #4caf50; color: white; }
    .pause { background: #ff9800; color: white; }
    .reset { background: #f44336; color: white; }
    .speed { margin: 0 10px; width: 100px; }
    .log-entry {
      margin: 2px 0;
    }
    .log-father { color: #1976d2; }
    .log-mother { color: #d32f2f; }
    .log-son { color: #388e3c; }
    .log-daughter { color: #7b1fa2; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸğŸŠ åƒæ°´æœé—®é¢˜å¯è§†åŒ– ğŸŠğŸ</h1>

    <div class="plate-area">
      <div class="plate" id="plate">ğŸ½ï¸</div>
    </div>

    <!-- æ–°å¢ï¼šç»Ÿè®¡é¢æ¿ -->
    <div style="display: flex; justify-content: center; gap: 15px; margin: 15px 0; flex-wrap: wrap;">
      <div style="background:#e3f2fd; padding:8px 12px; border-radius:6px; font-weight:bold;">ğŸ‘¨ çˆ¶äº²æ”¾è‹¹æœ: <span id="count-father">0</span></div>
      <div style="background:#ffebee; padding:8px 12px; border-radius:6px; font-weight:bold;">ğŸ‘© æ¯äº²æ”¾æ©˜å­: <span id="count-mother">0</span></div>
      <div style="background:#e8f5e9; padding:8px 12px; border-radius:6px; font-weight:bold;">ğŸ‘§ å¥³å„¿åƒè‹¹æœ: <span id="count-daughter">0</span></div>
      <div style="background:#f3e5f5; padding:8px 12px; border-radius:6px; font-weight:bold;">ğŸ‘¦ å„¿å­åƒæ©˜å­: <span id="count-son">0</span></div>
      <div style="background:#fff8e1; padding:8px 12px; border-radius:6px; font-weight:bold;">ğŸ“¦ ç›˜å­: <span id="plate-status">ç©º</span></div>
    </div>

    <div class="status-bar">
      <div class="person father">
        ğŸ‘¨ çˆ¶äº²<br>
        <span class="status" id="status-father">ç©ºé—²</span>
      </div>
      <div class="person mother">
        ğŸ‘© æ¯äº²<br>
        <span class="status" id="status-mother">ç©ºé—²</span>
      </div>
      <div class="person son">
        ğŸ‘¦ å„¿å­<br>
        <span class="status" id="status-son">ç©ºé—²</span>
      </div>
      <div class="person daughter">
        ğŸ‘§ å¥³å„¿<br>
        <span class="status" id="status-daughter">ç©ºé—²</span>
      </div>
    </div>

    <div>
      <strong>äº‹ä»¶æ—¥å¿—ï¼š</strong>
      <div class="log-container" id="log"></div>
    </div>

    <div class="controls">
      <button class="run" onclick="startSimulation()">â–¶ å¼€å§‹</button>
      <button class="pause" onclick="pauseSimulation()">â¸ æš‚åœ</button>
      <button class="reset" onclick="resetSimulation()">â†º é‡ç½®</button>
      <br><br>
      <label>é€Ÿåº¦ï¼š<input type="range" min="1" max="10" value="5" class="speed" id="speedSlider"></label>
    </div>
  </div>

  <script>
    // === å…¨å±€çŠ¶æ€æ–°å¢è®¡æ•°å™¨ ===
    let plate = null;
    let isRunning = false;
    let simulationActive = false;

    // è®¡æ•°å™¨
    const stats = {
      father: 0,
      mother: 0,
      son: 0,
      daughter: 0
    };

    // DOM å…ƒç´ å¼•ç”¨
    const logElement = document.getElementById('log');
    const statusElements = {
      father: document.getElementById('status-father'),
      mother: document.getElementById('status-mother'),
      son: document.getElementById('status-son'),
      daughter: document.getElementById('status-daughter')
    };
    const plateElement = document.getElementById('plate');
    const countElements = {
      father: document.getElementById('count-father'),
      mother: document.getElementById('count-mother'),
      son: document.getElementById('count-son'),
      daughter: document.getElementById('count-daughter')
    };
    const plateStatusElement = document.getElementById('plate-status');

    const logClass = {
      Father: 'log-father',
      Mother: 'log-mother',
      Son: 'log-son',
      Daughter: 'log-daughter'
    };

    // æ›´æ–°ç»Ÿè®¡é¢æ¿
    function updateStats() {
      countElements.father.textContent = stats.father;
      countElements.mother.textContent = stats.mother;
      countElements.son.textContent = stats.son;
      countElements.daughter.textContent = stats.daughter;

      if (plate === 'apple') plateStatusElement.textContent = 'ğŸ è‹¹æœ';
      else if (plate === 'orange') plateStatusElement.textContent = 'ğŸŠ æ©˜å­';
      else plateStatusElement.textContent = 'ç©º';
    }

    function addLog(actor, message) {
      const now = new Date().toLocaleTimeString();
      const div = document.createElement('div');
      div.className = 'log-entry ' + logClass[actor];
      div.textContent = `[${now}] ${actor}: ${message}`;
      logElement.appendChild(div);
      logElement.scrollTop = logElement.scrollHeight;
    }

    function updatePlate() {
      if (plate === 'apple') plateElement.textContent = 'ğŸ';
      else if (plate === 'orange') plateElement.textContent = 'ğŸŠ';
      else plateElement.textContent = 'ğŸ½ï¸';
      updateStats(); // åŒæ­¥æ›´æ–°çŠ¶æ€æ–‡å­—
    }

    const stateText = {
      idle: 'ç©ºé—²',
      trying: 'å°è¯•æ“ä½œ',
      waiting: 'ç­‰å¾…ä¸­...',
      working: 'æ­£åœ¨æ“ä½œ'
    };
    function updateStatus(person, state) {
      statusElements[person].textContent = stateText[state] || state;
    }

    function randomDelay(baseMin, baseMax) {
      const speed = document.getElementById('speedSlider').value;
      const factor = (11 - speed) * 0.2;
      const min = baseMin * factor;
      const max = baseMax * factor;
      return Math.random() * (max - min) + min;
    }

    // ===== è§’è‰²å‡½æ•°ï¼ˆæ–°å¢è®¡æ•°ï¼‰=====
    async function father() {
      while (simulationActive) {
        updateStatus('father', 'trying');
        addLog('Father', 'å°è¯•æ”¾è‹¹æœ...');

        while (simulationActive && plate !== null) {
          updateStatus('father', 'waiting');
          addLog('Father', 'ç›˜å­éç©ºï¼Œç­‰å¾…...');
          await new Promise(r => setTimeout(r, 300));
        }
        if (!simulationActive) break;

        plate = 'apple';
        stats.father++; // âœ… è®¡æ•° +1
        updatePlate();
        updateStatus('father', 'working');
        addLog('Father', 'æ”¾å…¥ä¸€ä¸ªè‹¹æœï¼');
        await new Promise(r => setTimeout(r, randomDelay(800, 1500)));
        updateStatus('father', 'idle');
      }
    }

    async function mother() {
      while (simulationActive) {
        updateStatus('mother', 'trying');
        addLog('Mother', 'å°è¯•æ”¾æ©˜å­...');

        while (simulationActive && plate !== null) {
          updateStatus('mother', 'waiting');
          addLog('Mother', 'ç›˜å­éç©ºï¼Œç­‰å¾…...');
          await new Promise(r => setTimeout(r, 300));
        }
        if (!simulationActive) break;

        plate = 'orange';
        stats.mother++; // âœ…
        updatePlate();
        updateStatus('mother', 'working');
        addLog('Mother', 'æ”¾å…¥ä¸€ä¸ªæ©˜å­ï¼');
        await new Promise(r => setTimeout(r, randomDelay(800, 1500)));
        updateStatus('mother', 'idle');
      }
    }

    async function son() {
      while (simulationActive) {
        updateStatus('son', 'trying');
        addLog('Son', 'æƒ³è¦æ©˜å­...');

        while (simulationActive && plate !== 'orange') {
          updateStatus('son', 'waiting');
          if (plate === null) {
            addLog('Son', 'ç›˜å­æ˜¯ç©ºçš„ï¼Œç­‰å¾…...');
          } else {
            addLog('Son', `ç›˜å­é‡Œæ˜¯${plate === 'apple' ? 'è‹¹æœ' : plate}ï¼Œä¸æ˜¯æ©˜å­ï¼Œç­‰å¾…...`);
          }
          await new Promise(r => setTimeout(r, 300));
        }
        if (!simulationActive) break;

        plate = null;
        stats.son++; // âœ…
        updatePlate();
        updateStatus('son', 'working');
        addLog('Son', 'æ‹¿åˆ°æ©˜å­ï¼Œå¼€å¿ƒåœ°åƒæ‰ï¼');
        await new Promise(r => setTimeout(r, randomDelay(1000, 2500)));
        updateStatus('son', 'idle');
      }
    }

    async function daughter() {
      while (simulationActive) {
        updateStatus('daughter', 'trying');
        addLog('Daughter', 'æƒ³è¦è‹¹æœ...');

        while (simulationActive && plate !== 'apple') {
          updateStatus('daughter', 'waiting');
          if (plate === null) {
            addLog('Daughter', 'ç›˜å­æ˜¯ç©ºçš„ï¼Œç­‰å¾…...');
          } else {
            addLog('Daughter', `ç›˜å­é‡Œæ˜¯${plate === 'orange' ? 'æ©˜å­' : plate}ï¼Œä¸æ˜¯è‹¹æœï¼Œç­‰å¾…...`);
          }
          await new Promise(r => setTimeout(r, 300));
        }
        if (!simulationActive) break;

        plate = null;
        stats.daughter++; // âœ…
        updatePlate();
        updateStatus('daughter', 'working');
        addLog('Daughter', 'æ‹¿åˆ°è‹¹æœï¼Œå¼€å¿ƒåœ°åƒæ‰ï¼');
        await new Promise(r => setTimeout(r, randomDelay(1000, 2500)));
        updateStatus('daughter', 'idle');
      }
    }

    // æ§åˆ¶å‡½æ•°
    function startSimulation() {
      if (isRunning) return;
      isRunning = true;
      simulationActive = true;
      addLog('System', 'æ¨¡æ‹Ÿå¼€å§‹ï¼');
      father();
      mother();
      son();
      daughter();
    }

    function pauseSimulation() {
      simulationActive = false;
      isRunning = false;
      addLog('System', 'æ¨¡æ‹Ÿå·²æš‚åœ');
    }

    function resetSimulation() {
      simulationActive = false;
      isRunning = false;
      plate = null;
      stats.father = stats.mother = stats.son = stats.daughter = 0;
      updatePlate();
      logElement.innerHTML = '';
      ['father', 'mother', 'son', 'daughter'].forEach(p => {
        updateStatus(p, 'idle');
      });
      updateStats(); // é‡ç½®ç»Ÿè®¡
      addLog('System', 'å·²é‡ç½®æ¨¡æ‹Ÿ');
    }

    // åˆå§‹åŒ–
    updatePlate();
  </script>
</body></html>